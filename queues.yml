- hosts:
    - queues

  pre_tasks:
  - include_vars: "{{item}}"
    with_items:
    - group_vars/all
    - pipeline/{{ pipeline }}/secrets.yml
    - pipeline/{{ pipeline }}/vars.yml
    - pipeline/{{ pipeline }}/taskqueue_vars.yml
  # - include_tasks: tasks/load_vars.yml

  roles:
    - role: 91de0n.rabbitmq
      rabbitmq_vhost_var: "{{project_queue_vhost}}"
      rabbitmq_user_var: "{{project_queue_user}}"
      rabbitmq_password_var: "{{project_queue_pass}}"

      when: "project_provider != 'aws' and project_task"
